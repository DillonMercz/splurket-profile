<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Codeply">
  <title>Splurket Profile</title>
  <base target="_self"> 
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-firestore.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">  
  

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
      crossorigin="anonymous"></script>

  <link rel="stylesheet" href="croppie/croppie.css">
  <script src="croppie/croppie.js"></script>

  <link rel="stylesheet" href="css/style.css">
  <style>/* CSS used here will be applied after bootstrap.css */</style>
</head>
<body>
  <div class="container">
    <center><h1>Edit Your Splurket Profile</h1></center>
  	<hr>
	<div class="row" style="margin:auto;">
      <!-- left column -->
      <div class="col-md-3">
        <!-- edit form column -->
        <div class="text-center">
          <div id="AddAlert" class="alert alert-warning alert-block" style="display:none;">
              <p id="AddAlertMessage"></p>
          </div>
              <div class="mt-3 row">
                  <div class="col-md-6">
                      <center><div id="uploaded_pic" hidden="hidden">
                          <img id="myImage" class="img-chosen" alt="Your image!"
                              src="" width="150px" height="150px" onchange="update_pic(this.src)"><hr>
                      </div>
                      <div hidden="hidden">
                      <input type="file" accept="image/*" name="upload_image" id="upload_image"><hr>
                    </div>
                      <center><button id="btnGrab" class="btn btn-success">Select New</button></center>
                      </div></center>
                      <br>
                  </div>
              </div>
      </div>
      <center><div class="col-md-9 personal-info">
        <!--<div class="alert alert-info alert-dismissable">
          <a class="panel-close close" data-dismiss="alert">Ã—</a> 
          <i class="fa fa-coffee"></i>
          This is an <strong>.alert</strong>. Use this to show important messages to the user.
        </div>-->
        <center><h3 id="avatarusername"></h3></center>
        
        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label class="col-md-3 control-label">Username:</label>
            <div class="col-md-8">
              <input class="form-control" type="text" id="username" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">First name:</label>
            <div class="col-lg-8">
              <input class="form-control" type="text" id="first_name" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">Last name:</label>
            <div class="col-lg-8">
              <input class="form-control" type="text" id="last_name" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">Email:</label>
            <div class="col-lg-8">
              <input class="form-control" type="text" id="email" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">Discord:</label>
            <div class="col-lg-8">
              <input class="form-control" type="text" id="discord" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">Company:</label>
            <div class="col-lg-8">
              <input class="form-control" type="text" id="company" value="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-lg-3 control-label">Phone Number:</label>
            <div class="col-lg-8">
              <input class="form-control" type="text" id="phone" value="">
            </div>
          </div>
          <!--<div class="form-group">
            <label class="col-md-3 control-label">Password:</label>
            <div class="col-md-8">
              <input class="form-control" type="password" id="password" value="11111122333">
            </div>
          </div>
          <div class="form-group">
            <label class="col-md-3 control-label">Confirm password:</label>
            <div class="col-md-8">
              <input class="form-control" type="password" value="11111122333">
            </div>
          </div>-->
          <div class="form-group">
            <label class="col-md-3 control-label"></label>
            <div class="col-md-8">
              <button type="button" class="btn btn-primary" style="background-color: #52b36c;border-color: #52b36c" onclick="savechanges()" value="Save Changes">Save Changes</button>
              <span></span>
              <input type="reset" class="btn btn-default" value="Cancel">
            </div>
          </div>
        </form>
      </div>
  </div>
</div></center>


      <!-- The Modal -->
      <div class="modal" id="uploadImageModal">
          <div class="modal-dialog">
              <div class="modal-content">

                  <!-- Modal Header -->
                  <div class="modal-header">
                      <h4 class="modal-title">Crop Image</h4>
                      <button id="closeModal" type="button" class="close" data-dismiss="modal">&times;</button>
                  </div>

                  <!-- Modal body -->
                  <div class="modal-body">
                      <div id="image_demo" style="width: 300px;"></div>
                  </div>

                  <!-- Modal footer -->
                  <div class="modal-footer">
                      <button id="confirmCrop" type="button" class="btn btn-success">Confirm!</button>
                  </div>

              </div>
          </div>
      </div>
  </body>
  <script>
      $("#myImage").click(function() {
          $("input[id='upload_image']").click();
  });
  </script>
  <script>
      $(function () {
          $image_crop = $('#image_demo').croppie(
              {
                  enableExif: true,
                  viewport: {
                      width: 150,
                      height: 150,
                      type: 'circle'
                  },
                  boundary: {
                      width: 300,
                      height: 300
                  }
              });

          $('#btnGrab').click(function () {
              $('#upload_image').click();
          });

          var selectedFile;

          $("#upload_image").change(function (evt) {
              if ((selectedFile = evt.target.files[0])) {
                  validateImageSizeType(selectedFile);
              }
          });

          function validateImageSizeType(selectedImage){
              var _URL = window.URL || window.webkitURL;
              var img = new Image();

              img.onload = function() {
                  if(this.width >= 200 && this.height >= 200){
                      readImgShowModal(selectedImage);
                  }
                  else
                  {
                      showAlert("This image doesn't have the minimum size required: 200px / 200px");
                      $('#upload_image').val('');
                  }
              };

              img.onerror = function() {
                  showAlert("File type not valid: " + selectedImage.type);
              };
              
              img.src = _URL.createObjectURL(selectedImage);
          }

          function showAlert(msj) {
              $('#AddAlertMessage').html(msj);
              $("#AddAlert").show();
              setTimeout(function () { $("#AddAlert").hide(); }, 3500);
          }

          function readImgShowModal(selectedImg){
              
              //document.getElementById("upload_image").value = "";
              $('#upload_image').val('');

              var reader = new FileReader();
              reader.onload = function (event) {
                  $image_crop.croppie('bind', {
                      url: event.target.result
                  }).then(function () {
                      console.log('Bind complete!');
                  });
              }
              reader.readAsDataURL(selectedImg);
              $('#uploadImageModal').modal('show');
          }

          $('#closeModal').click(function(){
              var vmyImage = document.getElementById("myImage");
              var vmyImg = new Image();

              vmyImage.title = "Your image!";
              vmyImg.title = "Your image!";

              var nameImage = document.getElementById("nameMyImage");
              var nameImg = document.getElementById("nameMyImg");

              nameImage.innerHTML = "avatar";
              nameImg.innerHTML = "avatar";
              
              vmyImage.src = "img/avatar-default-icon.png";
              vmyImg.src = "img/avatar_placeholder_temporary.png";

              vmyImg.className = "img-thumbnail img-chosen";
              vmyImg.alt = "Your image!";

              document.getElementById('myImg').innerHTML = "";
              document.getElementById('myImg').append(vmyImg);
          });

          $('#confirmCrop').click(function () {
              $image_crop.croppie('result', {
                  type: 'canvas',
                  size: 'viewport'
              }).then(function (response) {            
                  $('#noteInfo').html('You can select another picture!');

                  withJSpure(response);

                  $('#nameMyImg').html(selectedFile.name);

                  $('#myImg').html('');
                  $("<img>", {
                      "src": response,
                      "class": 'img-thumbnail img-chosen',
                      "alt": 'Your image!',
                      "title": selectedFile.name
                  }).appendTo("#myImg");            

                  $('#uploadImageModal').modal('hide');
              })
          });

          function withJSpure(resp) {
              var imgtag = document.getElementById("myImage");
              imgtag.title = selectedFile.name;

              var nameImg = document.getElementById("nameMyImage");
              
              imgtag.src = resp;
          }

          /*     $('#upload_image').change(function (evnt) {
                  $('#noteInfo').html('You can select another picture!');
              
                  onChangeUploadJSpure(evnt);
              
                  var selectedFile = event.target.files[0];
                  var reader = new FileReader();
              
                  $('#myImg').attr('title', selectedFile.name);
                  $('#nameMyImg').html(selectedFile.name);
              
                  reader.onload = function (event) {
                      $("#myImg").attr("src", event.target.result);
                  };
              
                  reader.readAsDataURL(selectedFile);
              }); */

          /* function onChangeUploadJSpure(evt) {
              var selectedFile = event.target.files[0];
              var reader = new FileReader();

              var imgtag = document.getElementById("myImage");
              imgtag.title = selectedFile.name;

              var nameImg = document.getElementById("nameMyImage");
              nameImg.innerHTML = selectedFile.name;

              reader.onload = function (event) {
                  imgtag.src = event.target.result;
              };

              reader.readAsDataURL(selectedFile);
          } */
      });
  </script>
        </div>
      </div>
      
      
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script>
    function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
        var name, email, photoUrl, uid, emailVerified;

        var config = {
            apiKey: "AIzaSyC-BUGGSsvUX8z4W1LcsJzS59yrL4__EsE",
            authDomain: "splurket-66df1.firebaseapp.com",
            databaseURL: "https://splurket-66df1-default-rtdb.firebaseio.com",
            projectId: "splurket-66df1",
            storageBucket: "splurket-66df1.appspot.com",
            messagingSenderId: "286706779903",
            appId: "1:286706779903:web:fd91c29319f9804e192eca",
            measurementId: "G-QWQ2M658KL"
          };
        firebase.initializeApp(config);
        const db = firebase.firestore();
        db.settings({ timestampsInSnapshots: true }); 
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // User is signed in.
            var user = firebase.auth().currentUser;
            //splurket@gmail.com
            var email1 = user.email;
            
            /*var email = getParameterByName('user'); 
            console.log(email)*/
            //still splurket
            
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Access-Control-Allow-Origin", "*")
            myHeaders.append("Accept", "application/json, /;q=0.5");

            var raw = JSON.stringify({
              "stringtoencrypt": `${email1}`
            });
            //document.write(raw)
            var requestOptions = {
              method: 'POST',
              headers: myHeaders,
              body: raw,
              redirect: 'follow'
            };

            fetch("https://americanrivergold.com/fluffybunnyin", requestOptions)
              .then(function (response) {
                  return response.json();
              })
              .then(function (data) {
                //should be a base64 string by now
                getuserdata(data);
            });
          } else {
            console.log('fuck')
            document.getElementById("avatar").style.display = "none";
            document.getElementById("login").style.display = "block";
          }
        });
        function getuserdata(data) {
            email = data.encryptedstring;
                var docRef = db.collection("users").doc(email);
                docRef.get().then((doc) => {
                    if (doc.exists) {
                        data1 = doc.data()
                        pro_pic = data1.pro_pic;
                        first_name = data1.first_name;
                        last_name = data1.last_name;
                        username = data1.username;
                        email = data1.email;
                        discord = data1.discord;
                        company = data1.company
                        phone = data1.phone_number
                        if (data1.username == "" ){
                            user_name = data1.email
                        }
                        if (data1.username != "") {
                            user_name = data1.username;
                        }
                        document.getElementById("myImage").src = pro_pic;
                        document.getElementById("avatarusername").innerText = "Profile Info For " + user_name + ":";
                        //document.getElementById("avatarusername1").innerText = "Signed In As: " + user_name;
                        document.getElementById("uploaded_pic").style.display = "block";
                        document.getElementById("first_name").value = first_name;
                        document.getElementById("last_name").value = last_name;
                        document.getElementById("username").value = username;
                        document.getElementById("email").value = email;
                        document.getElementById("discord").value = discord;
                        document.getElementById("company").value = company;
                        document.getElementById("phone").value = phone;

                    } else {
                        // doc.data() will be undefined in this case
                        console.log("No such document!");
                        console.log(doc.data())
                    }
                }).catch((error) => {
                    console.log("Error getting document:", error);
                });
        }
        function signout() {
            firebase.auth().signOut().then(() => {
              // Sign-out successful.
            }).catch((error) => {
              // An error happened.
            });
        }
        function savechanges() {
          var user = firebase.auth().currentUser;
            //splurket@gmail.com
            var email1 = user.email;
            
            /*var email = getParameterByName('user'); 
            console.log(email)*/
            //still splurket
            
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Accept", "application/json, /;q=0.5");

            var raw = JSON.stringify({
              "stringtoencrypt": `${email1}`
            });
            //document.write(raw)
            var requestOptions = {
              method: 'POST',
              headers: myHeaders,
              body: raw,
              redirect: 'follow'
            };

            fetch("https://americanrivergold.com/fluffybunnyin", requestOptions)
              .then(function (response) {
                  return response.json();
              })
              .then(function (data) {
                //should be a base64 string by now
                email1 = data.encryptedstring;
                first_name_send = document.getElementById("first_name").value;
                last_name_send = document.getElementById("last_name").value;
                username_send = document.getElementById("username").value;
                email_send = document.getElementById("email").value;
                discord_send = document.getElementById("discord").value;
                company_send = document.getElementById("company").value;
                phone_send = document.getElementById("phone").value;
                db.collection('users').doc(email1).update({
                        first_name: first_name_send,
                        last_name: last_name_send,
                        username: username_send,
                        email: email_send,
                        discord: discord_send,
                        phone_number: phone_send,
                        company: company_send,
            })
          });
        }
      function update_pic(source){

          // Convert the file to base64
          let base64Image = source;

          // Create our url
          let url = URL(string: "https://api.imgur.com/3/image")
          let request = NSMutableURLRequest.init(url: url)
          request.httpMethod = "POST"
          request.addValue("Client-ID " + 'c83b7110028cc7c', forHTTPHeaderField: "Authorization")

          // Build our multiform and add our base64 image
          let boundary = NSUUID().uuidString
          request.setValue("multipart/form-data; boundary=\(boundary)", forHTTPHeaderField: "Content-Type")
          let body = NSMutableData()
          body.append("--\(boundary)\r\n".data(using: .utf8)!)
          body.append("Content-Disposition: form-data; name=\"image\"\r\n\r\n".data(using: .utf8)!)
          body.append(base64Image.data(using: .utf8)!)
          body.append("\r\n".data(using: .utf8)!)
          body.append("--\(boundary)--\r\n".data(using: .utf8)!)
          request.httpBody = body as Data

          // Begin the session request
          let task = URLSession.shared.dataTask(with: request as URLRequest){ data, response, error in
              if (error != nil){
                  print("error: \(error)")
                  return
              }

              print("response: \(response!)")
              let responseString = NSString(data: data!, encoding: String.Encoding.utf8.rawValue)
              print("response string: \(responseString!)")

          }
          task.resume()
      }
  </script>

<script src="croppie/croppie.js"></script>

</body></html>